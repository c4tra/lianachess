<html>
<head>
    <title>lianachess v0.1.4</title>
    <style type="text/css">
        table {
            border-collapse: collapse;
            font-size: 25px;
            text-align: center;
        }

        table tr td {
            width: 70px;
            height: 70px;
            border: 2px solid black;
            vertical-align: middle;
            padding: 0;
        }

        #capturedPieces{
            font-size: 18px;
        }

        #capturedPieces img {
            width: 40px;
            margin-right: 20px;
        }

        .piece {
            width:60px;
            margin-left: 5px;
            margin-right: 5px;
        }

        /* Add styling for white and black squares */
        td.black {
            background-color: #999;
        }

        td.white {
            background-color: #fff;
        }
    </style>
</head>
<body>
    <h1>lianachess v0.1.4 (cursedandbroken)</h1>
    <table id="chessBoard">
        <!-- Use JavaScript to populate the chessboard -->
    </table>
    <div id="capturedPieces">
        <div id="blackCaptured">
            <!-- Captured black pieces will be displayed here -->
        </div>
        <div id="whiteCaptured">
            <!-- Captured white pieces will be displayed here -->
        </div>
    </div>
</body>
<script>
// Set up the chessboard
const chessBoard = document.getElementById('chessBoard');
const rows = 8;
const cols = 8;
const white = 'white';
const black = 'black';
let turn = white;  // Track whose turn it is
const capturedPieces = {
    white: [],  // Array to store captured white pieces
    black: []   // Array to store captured black pieces
};

// Initialize the chessboard with empty squares
for (let i = 0; i < rows; i++) {
    const row = document.createElement('tr');
    for (let j = 0; j < cols; j++) {
        const col = document.createElement('td');
        col.setAttribute('id', `${i}-${j}`);  // Set the square's id to its coordinates
        // Add a class to differentiate white and black squares
        if ((i + j) % 2 === 0) {
            col.classList.add('black');
        } else {
            col.classList.add('white');
        }
        row.appendChild(col);
    }
    chessBoard.appendChild(row);
}

// Set up the pieces
const pieces = {
    white: {
        king: 'wK.png',
        queen: 'wQ.png',
        rook: 'wR.png',
        bishop: 'wB.png',
        knight: 'wN.png',
        pawn: 'wP.png'
    },
    black: {
        king: 'bK.png',
        queen: 'bQ.png',
        rook: 'bR.png',
        bishop: 'bB.png',
        knight: 'bN.png',
        pawn: 'bP.png'
    }
};

// Populate the chessboard with pieces
const pieceKeys = Object.keys(pieces.white);  // Get the names of all the piece types
for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {
        // Place white pieces on the top row and black pieces on the bottom row
        if (i === 0) {
            const piece = document.createElement('img');
            piece.setAttribute('src', pieces.black[pieceKeys[j]]);
            piece.classList.add('piece');
            document.getElementById(`${i}-${j}`).appendChild(piece);
        } else if (i === 1) {
            const piece = document.createElement('img');
            piece.setAttribute('src', pieces.black[pieceKeys[5]]);
            piece.classList.add('piece');
            document.getElementById(`${i}-${j}`).appendChild(piece);
        } else if (i === 6) {
            const piece = document.createElement('img');
            piece.setAttribute('src', pieces.white[pieceKeys[5]]);
            piece.classList.add('piece');
            document.getElementById(`${i}-${j}`).appendChild(piece);
        } else if (i === 7) {
            const piece = document.createElement('img');
            piece.setAttribute('src', pieces.white[pieceKeys[j]]);
            piece.classList.add('piece');
            document.getElementById(`${i}-${j}`).appendChild(piece);
        }
    }
}

// Add event listeners to the chessboard squares to allow pieces to be selected and moved
for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {
document.getElementById(`${i}-${j}`).addEventListener('click', function() {
    // Check if the square is occupied by a piece of the correct color
    if (this.children.length > 0 && this.children[0].src.includes(turn)) {
        // Select the piece
        const selectedPiece = this.children[0];
        // Add a border to the selected square to indicate it is selected
        this.style.border = '4px solid blue';
        // Add event listeners to all the other squares to allow the selected piece to be moved
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                if (`${i}-${j}` !== this.id) {
                    document.getElementById(`${i}-${j}`).addEventListener('click', function() {
                        // Check if the destination square is empty or contains an enemy piece
                        if (this.children.length === 0 || (this.children.length > 0 && !this.children[0].src.includes(turn))) {
                            // Check if the move is legal (implementation of chess rules is left as an exercise to the reader)
                            if (isLegalMove(selectedPiece, this)) {
                                // Move the piece
                                this.appendChild(selectedPiece);
                                // Remove the border from the selected square
                                document.getElementById(selectedPiece.parentNode.id).style.border = '2px solid black';
                                // Check if an enemy piece has been captured
                                if (this.children.length > 1) {
                                    // Remove the captured piece from the board and add it to the captured pieces array
                                    const capturedPiece = this.children[0];
                                    capturedPieces[turn].push(capturedPiece);
                                    this.removeChild(capturedPiece);
                                    // Update the captured pieces display
                                    updateCapturedPiecesDisplay();
                                }
                                // Enable drag and drop
                                dragAndDrop(selectedPiece, this);
                                // Change the turn
                                turn = (turn === white) ? black : white;
                            }
                        }
                    });
                }
            }
        }
    }
})
    }
}

// Function to update the captured pieces display
function updateCapturedPiecesDisplay() {
    const blackCaptured = document.getElementById('blackCaptured');
    const whiteCaptured = document.getElementById('whiteCaptured');
    blackCaptured.innerHTML = '';
    whiteCaptured.innerHTML = '';
    for (let i = 0; i < capturedPieces.black.length; i++) {
        blackCaptured.appendChild(capturedPieces.black[i]);
    }
    for (let i = 0; i < capturedPieces.white.length; i++) {
        whiteCaptured.appendChild(capturedPieces.white[i]);
    }
}
</script>
</html>
